<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>optihood.plot_functions &mdash; pytrnsys  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> pytrnsys
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/defining_an_energy_network.html">Defining an energy network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/optimizing_the_energy_network.html">Optimizing the energy network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/processing_results.html">Processing results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/advanced_under_development_features.html">Advanced under-development features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Code Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pytrnsys</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>optihood.plot_functions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for optihood.plot_functions</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">tkr</span>

<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">layout</span><span class="p">,</span> <span class="n">gridplot</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">DatetimeTickFormatter</span><span class="p">,</span> <span class="n">HoverTool</span><span class="p">,</span> <span class="n">Legend</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_file</span>

<span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">isoparse</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># This file defines different functions for the plotting of the results of the optimization.</span>
<span class="c1"># The plots are made at the end of this file, introducing a .xls file previously created during the optimization.</span>
<span class="c1"># An important parameter &quot;optMode&quot; needs to be set when running the code (look in the __main__ fragment)</span>


<div class="viewcode-block" id="monthlyBalance"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.monthlyBalance">[docs]</a><span class="k">def</span> <span class="nf">monthlyBalance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="n">new_legends</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for the definition of the monthly summary of a bus</span>
<span class="sd">    :param data: dict type, results from the optimization applied to one bus</span>
<span class="sd">    :param bus: str type, bus from which the summary is required</span>
<span class="sd">    :param new_legends: dict type, new legends to plot on the graph</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">building</span> <span class="o">=</span> <span class="s2">&quot;__&quot;</span> <span class="o">+</span> <span class="n">bus</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;electricityLink&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">elLinks</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;electricityLink&#39;</span><span class="p">)</span>  <span class="c1"># half would be el_link_out and half would be el_link_in</span>
        <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;electricityLink&#39;</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elLinks</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">elLinksOut</span> <span class="o">=</span> <span class="n">elLinks</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">mid</span><span class="p">]</span>
        <span class="n">elLinksIn</span> <span class="o">=</span> <span class="n">elLinks</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">mid</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">elLinks</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span>
        <span class="n">elLinksOut</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityBus&#39;, &#39;electricityLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elLinksOut</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">elLinksIn</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityLink&#39;, &#39;electricityInBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elLinksIn</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">elLinksIn</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityLink&#39;, &#39;electricityInBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">elLinksOut</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityBus&#39;, &#39;electricityLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">data_month</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">monthShortNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">]</span>

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_month</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">monthShortNames</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">data_month</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">neg_flow</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pos_flow</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="s2">&quot;Bus&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">neg_flow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos_flow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">mark</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">neg_flow</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">monthShortNames</span><span class="p">,</span> <span class="o">-</span><span class="n">data_month</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">bottom</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">mark</span><span class="p">))</span>
        <span class="n">mark</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">data_month</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">mark</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pos_flow</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">monthShortNames</span><span class="p">,</span> <span class="n">data_month</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">bottom</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">mark</span><span class="p">))</span>
        <span class="n">mark</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_month</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="c1"># Shrink current axis by 20%</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">box</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span><span class="p">])</span>

    <span class="c1"># Put a legend to the right of the current axis</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;electricity&quot;</span> <span class="ow">in</span> <span class="n">bus</span> <span class="ow">or</span> <span class="s2">&quot;grid&quot;</span> <span class="ow">in</span> <span class="n">bus</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Monthly electricity balance for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="s2">&quot;spaceHeating&quot;</span> <span class="ow">in</span> <span class="n">bus</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Monthly space heating balance for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Monthly domestic hot water balance for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="hourlyDailyPlot"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.hourlyDailyPlot">[docs]</a><span class="k">def</span> <span class="nf">hourlyDailyPlot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="n">palette</span><span class="p">,</span> <span class="n">new_legends</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for the bokeh plot of hourly and daily balance of a bus</span>
<span class="sd">    :param data: list of dict type, results from the optimization</span>
<span class="sd">    :param bus: list of str type, buses from which the summary is required</span>
<span class="sd">    :param palette: palette type form bokeh.palettes (For example, Category10_8), different types can be found on</span>
<span class="sd">    https://docs.bokeh.org/en/latest/docs/reference/palettes.html or</span>
<span class="sd">    https://docs.bokeh.org/en/latest/_modules/bokeh/palettes.html</span>
<span class="sd">    :param new_legends: dict type, new legends to plot on the graph</span>
<span class="sd">    For example, Category10_8</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_figs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">p_figs_h</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">p_figs_d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">p_plots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">building</span> <span class="o">=</span> <span class="s1">&#39;__&#39;</span> <span class="o">+</span> <span class="n">bus</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;electricity&quot;</span> <span class="ow">in</span> <span class="n">bus</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">del</span> <span class="n">bus</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">bus</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;((&#39;electricityProdBus</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;, &#39;electricitySource</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;), &#39;flow&#39;)&quot;</span><span class="p">)</span>
            <span class="n">elLinks</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;electricityLink&#39;</span><span class="p">)</span>  <span class="c1">#half would be el_link_out and half would be el_link_in</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span> <span class="o">=</span> <span class="s1">&#39;electricityLink&#39;</span><span class="p">)),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elLinks</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">elLinksOut</span> <span class="o">=</span> <span class="n">elLinks</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">mid</span><span class="p">]</span>
            <span class="n">elLinksIn</span> <span class="o">=</span> <span class="n">elLinks</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">mid</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">elLinks</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span>
            <span class="n">elLinksOut</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityBus&#39;, &#39;electricityLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elLinksOut</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">elLinksIn</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityLink&#39;, &#39;electricityInBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elLinksIn</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">dt</span><span class="p">,</span> <span class="n">elLinksIn</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityLink&#39;, &#39;electricityInBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">dt</span><span class="p">,</span> <span class="n">elLinksOut</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityBus&#39;, &#39;electricityLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">data_day</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hourly electricity flows for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_both&quot;</span><span class="p">)</span>
            <span class="n">p1</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Legend</span><span class="p">(),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">p1</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;@x{</span><span class="si">%d</span><span class="s1">/%m/%Y %H:%M:%S}&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;@y</span><span class="si">{0.00}</span><span class="s1">&#39;</span><span class="p">)],</span>
                                   <span class="n">formatters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;@x&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">},</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">))</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Daily electricity flows for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_both&quot;</span><span class="p">)</span>
            <span class="n">p2</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Legend</span><span class="p">(),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">p2</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;@x{</span><span class="si">%d</span><span class="s1">/%m/%Y}&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;@y</span><span class="si">{0.00}</span><span class="s1">&#39;</span><span class="p">)],</span>
                                   <span class="n">formatters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;@x&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">},</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_figs_h</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p1</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">p_figs_h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_range</span>
                <span class="n">p2</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">p_figs_d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_range</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
                <span class="n">p1</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dt</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">p2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data_day</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">p_figs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">])</span>
            <span class="n">p_figs_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p_figs_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="n">p_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;shSource&quot;</span> <span class="ow">in</span> <span class="n">bus</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">shLinks</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">like</span><span class="o">=</span><span class="s1">&#39;shLink&#39;</span><span class="p">)</span>  <span class="c1"># half would be el_link_out and half would be el_link_in</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;shLink&#39;</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">mid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shLinks</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">shLinksOut</span> <span class="o">=</span> <span class="n">shLinks</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">mid</span><span class="p">]</span>
            <span class="n">shLinksIn</span> <span class="o">=</span> <span class="n">shLinks</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">mid</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">shLinks</span><span class="o">.</span><span class="n">columns</span><span class="p">)]</span>
            <span class="n">shLinksOut</span><span class="p">[</span><span class="s2">&quot;((&#39;spaceHeatingBus&#39;, &#39;shLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shLinksOut</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">shLinksIn</span><span class="p">[</span><span class="s2">&quot;((&#39;shLink&#39;, &#39;shDemandBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shLinksIn</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">dt</span><span class="p">,</span> <span class="n">shLinksIn</span><span class="p">[</span><span class="s2">&quot;((&#39;shLink&#39;, &#39;shDemandBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">dt</span><span class="p">,</span> <span class="n">shLinksOut</span><span class="p">[</span><span class="s2">&quot;((&#39;spaceHeatingBus&#39;, &#39;shLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data_day</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hourly space heating flows for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_both&quot;</span><span class="p">)</span>
            <span class="n">p3</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Legend</span><span class="p">(),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">p3</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;@x{</span><span class="si">%d</span><span class="s1">/%m/%Y %H:%M:%S}&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;@y</span><span class="si">{0.00}</span><span class="s1">&#39;</span><span class="p">)],</span>
                                   <span class="n">formatters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;@x&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">},</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">))</span>
            <span class="n">p4</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Daily space heating flows for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_both&quot;</span><span class="p">)</span>
            <span class="n">p4</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Legend</span><span class="p">(),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">p4</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;@x{</span><span class="si">%d</span><span class="s1">/%m/%Y}&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;@y</span><span class="si">{0.00}</span><span class="s1">&#39;</span><span class="p">)],</span>
                                   <span class="n">formatters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;@x&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">},</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_figs_h</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p3</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">p_figs_h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_range</span>
                <span class="n">p4</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">p_figs_d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_range</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
                <span class="n">p3</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dt</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">p4</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data_day</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">p_figs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">])</span>
            <span class="n">p_figs_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
            <span class="n">p_figs_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p4</span><span class="p">)</span>
            <span class="n">p_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
            <span class="n">p_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p4</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">data_day</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;1d&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="n">p5</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hourly domestic hot water flows for &quot;</span> <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_both&quot;</span><span class="p">)</span>
            <span class="n">p5</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Legend</span><span class="p">(),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">p5</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;@x{</span><span class="si">%d</span><span class="s1">/%m/%Y %H:%M:%S}&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;@y</span><span class="si">{0.00}</span><span class="s1">&#39;</span><span class="p">)],</span>
                                   <span class="n">formatters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;@x&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">},</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">))</span>
            <span class="n">p6</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Daily domestic hot water flows for &quot;</span>  <span class="o">+</span> <span class="n">building</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_both&quot;</span><span class="p">)</span>
            <span class="n">p6</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">Legend</span><span class="p">(),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">p6</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;@x{</span><span class="si">%d</span><span class="s1">/%m/%Y}&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;@y</span><span class="si">{0.00}</span><span class="s1">&#39;</span><span class="p">)],</span>
                                   <span class="n">formatters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;@x&#39;</span><span class="p">:</span> <span class="s1">&#39;datetime&#39;</span><span class="p">},</span>
                                   <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_figs_h</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">p5</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">p_figs_h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_range</span>
                <span class="n">p6</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">p_figs_d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_range</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
                <span class="n">p5</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dt</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
                <span class="n">p6</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_day</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data_day</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="n">new_legends</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">building</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">p_figs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p5</span><span class="p">,</span> <span class="n">p6</span><span class="p">])</span>
            <span class="n">p_figs_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p5</span><span class="p">)</span>
            <span class="n">p_figs_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p6</span><span class="p">)</span>
            <span class="n">p_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p5</span><span class="p">)</span>
            <span class="n">p_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p6</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_plots</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">DatetimeTickFormatter</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> %b&quot;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;8pt&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">p_figs_h</span><span class="p">,</span> <span class="n">p_figs_d</span><span class="p">)</span></div>


<div class="viewcode-block" id="toColor"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.toColor">[docs]</a><span class="k">def</span> <span class="nf">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function from the URBS platform https://github.com/ojdo/urbs/blob/1house/comp.py</span>
<span class="sd">    Assign a deterministic pseudo-random color to argument.</span>
<span class="sd">    If COLORS[obj] is set, return that. For strings, this value depends only</span>
<span class="sd">    on the string content, so that same strings always yield the same color.</span>
<span class="sd">    :param COLORS: dict of components and their assigned color</span>
<span class="sd">    :param obj: any hashable object</span>
<span class="sd">    :return: a (r, g, b) color tuple if COLORS[obj] is set, otherwise a hexstring</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rgb</span> <span class="o">/</span> <span class="mf">255.0</span> <span class="k">for</span> <span class="n">rgb</span> <span class="ow">in</span> <span class="n">COLORS</span><span class="p">[</span><span class="n">obj</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># random deterministic color</span>
        <span class="kn">import</span> <span class="nn">hashlib</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">color</span></div>


<div class="viewcode-block" id="groupHbarPlots"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.groupHbarPlots">[docs]</a><span class="k">def</span> <span class="nf">groupHbarPlots</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">group_size</span><span class="p">,</span> <span class="n">inner_sep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function from the URBS platform https://github.com/ojdo/urbs/blob/1house/comp.py</span>
<span class="sd">    Group bars of a horizontal barplot closer together.</span>
<span class="sd">    Given an existing horizontal bar plot handle ax, move bars of a given group size (&gt;=2) closer together,</span>
<span class="sd">    reducing the distance within the bars of a group, but increasing the distance between different groups.</span>
<span class="sd">    By default, bars are placed within a coordinate system 1 unit apart. The space between two bars has</span>
<span class="sd">    size 1 - bar_height, which can be specified in matplotlib (and pandas) using the `width` argument.</span>
<span class="sd">    :param ax: matplotlib axis</span>
<span class="sd">    :param group_size: int type, how many bars to group together</span>
<span class="sd">    :param inner_sep: float type, vertical spacing within group (optional). Default: reduce the distance to a half</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">bar_height</span> <span class="o">=</span> <span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>  <span class="c1"># assumption: identical for all</span>

    <span class="k">if</span> <span class="n">inner_sep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inner_sep</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bar_height</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">handles</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">patch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
            <span class="n">group_number</span><span class="p">,</span> <span class="n">row_within_group</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">group_size</span><span class="p">)</span>

            <span class="n">group_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">group_number</span> <span class="o">*</span> <span class="n">group_size</span>
                            <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">group_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">inner_sep</span><span class="p">)</span>
                            <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">group_size</span> <span class="o">*</span> <span class="n">bar_height</span><span class="p">))</span>

            <span class="n">patch</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="n">row_within_group</span> <span class="o">*</span> <span class="p">(</span><span class="n">bar_height</span> <span class="o">+</span> <span class="n">inner_sep</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">group_offset</span><span class="p">)</span></div>


<div class="viewcode-block" id="deduplicateLegend"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.deduplicateLegend">[docs]</a><span class="k">def</span> <span class="nf">deduplicateLegend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function from the URBS platform https://github.com/ojdo/urbs/blob/1house/comp.py</span>
<span class="sd">    Remove double entries from figure legend.</span>
<span class="sd">    :param handles: list of legend entry handles</span>
<span class="sd">    :param labels: list of legend entry labels</span>
<span class="sd">    :return: (handles, labels) tuple of lists with duplicate labels removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_handles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hdl</span><span class="p">,</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">new_labels</span><span class="p">:</span>
            <span class="n">new_handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdl</span><span class="p">)</span>
            <span class="n">new_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
    <span class="c1"># also, sort both lists accordingly</span>
    <span class="n">new_labels</span><span class="p">,</span> <span class="n">new_handles</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">new_labels</span><span class="p">,</span> <span class="n">new_handles</span><span class="p">))))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">new_handles</span><span class="p">,</span> <span class="n">new_labels</span><span class="p">)</span></div>


<div class="viewcode-block" id="resultingDataDiagram"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.resultingDataDiagram">[docs]</a><span class="k">def</span> <span class="nf">resultingDataDiagram</span><span class="p">(</span><span class="n">elBus</span><span class="p">,</span> <span class="n">shBus</span><span class="p">,</span> <span class="n">dhwBus</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">COLORS</span><span class="p">,</span> <span class="n">building</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function inspired from the URBS platform https://github.com/ojdo/urbs/blob/1house/comp.py</span>
<span class="sd">    Function plotting the different results of the optimization. First, costs will be plotted, then the energy produced,</span>
<span class="sd">    comparing energy for electricity bus, sh and dhw bus, and finally the retrieved energy from the storages.</span>
<span class="sd">    :param elBus: dict type, results from the optimization applied to one bus.</span>
<span class="sd">    :param shBus: dict type, results from the optimization applied to one bus.</span>
<span class="sd">    :param dhwBus: dict type, results from the optimization applied to one bus.</span>
<span class="sd">    :param costs: dict type, resulting costs from the optimization</span>
<span class="sd">    :param env: dict type, resulting environmental impacts from the optimization</span>
<span class="sd">    :param COLORS: list type, different colors for the different components of the system</span>
<span class="sd">    :param building: str type, name of the building</span>
<span class="sd">    :return: Four bar plots and the costs, environmental impacts, production and storage dict created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">production</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">optMode</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">elBus</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Storage&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
            <span class="n">storage</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])]</span>
        <span class="k">elif</span> <span class="n">optMode</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span> <span class="ow">and</span> <span class="s2">&quot;electricityLink&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;_in&quot;</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_in&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">production</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_in&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">production</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_in&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])]</span>
                    <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_in&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s2">&quot;_out&quot;</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_out&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">production</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_out&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">production</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_out&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])]</span>
                    <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_out&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="s2">&quot;Storage&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;Demand&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">production</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])]</span>

            <span class="c1"># specific for negative flows</span>
            <span class="k">if</span> <span class="s2">&quot;HP_SH&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">or</span> <span class="s2">&quot;HP_DHW&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>

    <span class="n">production</span><span class="p">[</span><span class="s2">&quot;HP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">alpha</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">shBus</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Storage&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
            <span class="n">storage</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">shBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;Storage&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;Demand&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">production</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">shBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">dhwBus</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Storage__&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;out&quot;</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
            <span class="n">storage</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">dhwBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;Storage__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;Demand&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">production</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">dhwBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">costs</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">costs</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">building</span><span class="p">})</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">env</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">j</span><span class="p">]})</span>

    <span class="n">production</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">production</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">production</span> <span class="o">=</span> <span class="n">production</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">storage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dhw&quot;</span><span class="p">,</span> <span class="s2">&quot;sh&quot;</span><span class="p">,</span> <span class="s2">&quot;elec&quot;</span><span class="p">])</span>
    <span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>

    <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">costs_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">costs</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp0</span> <span class="o">=</span> <span class="n">costs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">costs_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">env_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp1</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">env_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">production_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">production</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp2</span> <span class="o">=</span> <span class="n">production</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">production_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

    <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">storage_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">storage</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp3</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">storage_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># remove scenario names from other bar plots</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]:</span>
        <span class="n">groupHbarPlots</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">group_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inner_sep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>

    <span class="c1"># set limits and ticks for both axes</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="c1"># group 1,000,000 with commas</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">group_thousands_and_skip_first</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{:0,d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">group_thousands_and_skip_first</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skip_lowest</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">skip_lowest</span><span class="p">)</span>

        <span class="c1"># legend</span>
        <span class="c1"># set style arguments</span>
        <span class="n">legend_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;lower center&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ncol&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">.99</span><span class="p">)}</span>
        <span class="c1"># get handels and labels, remove duplicate labels</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">deduplicateLegend</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">())</span>
        <span class="c1"># set legend to use those</span>
        <span class="n">lg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_style</span><span class="p">)</span>
        <span class="c1"># finally, remove lines from patches</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">lg</span><span class="o">.</span><span class="n">get_patches</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total costs (CHF)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total environmental impacts (kgCo2eq)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total energy produced (kWh)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Retrieved energy (kWh)&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">production</span><span class="p">,</span> <span class="n">storage</span></div>


<div class="viewcode-block" id="resultingDataDiagramLoop"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.resultingDataDiagramLoop">[docs]</a><span class="k">def</span> <span class="nf">resultingDataDiagramLoop</span><span class="p">(</span><span class="n">elec</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">dhw</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">buildings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function inspired from the URBS platform https://github.com/ojdo/urbs/blob/1house/comp.py</span>
<span class="sd">    Function plotting the graph comparing the different buildings/scenarios on costs, energy produced and energy</span>
<span class="sd">    retrieved from storages</span>
<span class="sd">    :param elec: list of dict type, optimization results</span>
<span class="sd">    :param sh: list of dict type, optimization results</span>
<span class="sd">    :param dhw: list of dict type, optimization results</span>
<span class="sd">    :param costs: list of dict type, optimization results</span>
<span class="sd">    :param env: list of dict type, optimization results</span>
<span class="sd">    :param colors: list type, different colors for the different components of the system</span>
<span class="sd">    :param buildings: list of str type, name of the different buildings</span>
<span class="sd">    :return: figure created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_costs</span><span class="p">,</span> <span class="n">n_env</span><span class="p">,</span> <span class="n">n_production</span><span class="p">,</span> <span class="n">n_storage</span> <span class="o">=</span> <span class="n">resultingDataDiagram</span><span class="p">(</span><span class="n">elec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dhw</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">costs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="p">,</span> <span class="n">buildings</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elec</span><span class="p">)):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">resultingDataDiagram</span><span class="p">(</span><span class="n">elec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dhw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">costs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">env</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">colors</span><span class="p">,</span> <span class="n">buildings</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">n_costs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n_costs</span><span class="p">,</span> <span class="n">a</span><span class="p">])</span>
        <span class="n">n_env</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n_env</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
        <span class="n">n_production</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n_production</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
        <span class="n">n_storage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n_storage</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>

    <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">costs_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_costs</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp0</span> <span class="o">=</span> <span class="n">n_costs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">costs_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">env_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_env</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp1</span> <span class="o">=</span> <span class="n">n_env</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">env_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">production_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_production</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp2</span> <span class="o">=</span> <span class="n">n_production</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">production_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

    <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">storage_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_storage</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp3</span> <span class="o">=</span> <span class="n">n_storage</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">storage_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># remove scenario names from other bar plots</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]:</span>
        <span class="n">groupHbarPlots</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">group_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inner_sep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="c1"># set limits and ticks for both axes</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="c1"># group 1,000,000 with commas</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">group_thousands_and_skip_first</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{:0,d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">group_thousands_and_skip_first</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skip_lowest</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">skip_lowest</span><span class="p">)</span>

        <span class="c1"># legend</span>
        <span class="c1"># set style arguments</span>
        <span class="n">legend_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;lower center&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ncol&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">.99</span><span class="p">)}</span>
        <span class="c1"># get handels and labels, remove duplicate labels</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">deduplicateLegend</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">())</span>
        <span class="c1"># set legend to use those</span>
        <span class="n">lg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_style</span><span class="p">)</span>
        <span class="c1"># finally, remove lines from patches</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">lg</span><span class="o">.</span><span class="n">get_patches</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total costs (CHF)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total environmental impacts (kgCo2eq)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Total energy produced (kWh)</span><span class="se">\n</span><span class="s1"> First line: electricity, Second line: space heating,</span><span class="se">\n</span><span class="s1"> Third line: domestic hot water&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Retrieved energy (kWh)</span><span class="se">\n</span><span class="s1"> First line: electricity, Second line: space heating,</span><span class="se">\n</span><span class="s1"> Third line: domestic hot water&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="resultingDataDemandDiagram"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.resultingDataDemandDiagram">[docs]</a><span class="k">def</span> <span class="nf">resultingDataDemandDiagram</span><span class="p">(</span><span class="n">elBus</span><span class="p">,</span> <span class="n">shBus</span><span class="p">,</span> <span class="n">dhwBus</span><span class="p">,</span> <span class="n">COLORS</span><span class="p">,</span> <span class="n">building</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function inspired from the URBS platform https://github.com/ojdo/urbs/blob/1house/comp.py</span>
<span class="sd">    Function plotting the different results of the optimization. First, costs will be plotted, then the energy produced,</span>
<span class="sd">    comparing energy for electricity bus, sh and dhw bus, and finally the retrieved energy from the storages.</span>
<span class="sd">    :param elBus: dict type, results from the optimization applied to one bus. Called like &quot;solph.views.node(results, bus)&quot;</span>
<span class="sd">    :param shBus: dict type, results from the optimization applied to one bus. Called like &quot;solph.views.node(results, bus)&quot;</span>
<span class="sd">    :param dhwBus: dict type, results from the optimization applied to one bus. Called like &quot;solph.views.node(results, bus)&quot;</span>
<span class="sd">    :param COLORS: list type, different colors for the different components of the system</span>
<span class="sd">    :param building: str type, name of the building</span>
<span class="sd">    :return: Three bar plots and the elec, sh and dhw dict created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elec</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dhw</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">optMode</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">elBus</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Demand&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])]</span>
        <span class="k">elif</span> <span class="s2">&quot;producedElectricity&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">or</span> <span class="s2">&quot;gridElectricity&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">optMode</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span> <span class="ow">and</span> <span class="s2">&quot;electricityLink&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;_in&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">elBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;Storage&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;in&quot;</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
            <span class="k">del</span> <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span>
        <span class="k">elif</span> <span class="s2">&quot;electricity&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="ow">and</span> <span class="s2">&quot;Demand&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span>
        <span class="k">elif</span> <span class="s2">&quot;Resource&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">or</span> <span class="s2">&quot;excess&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">elec</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span>

    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">shBus</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Demand&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">sh</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">shBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sh</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">shBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;Storage&quot;</span> <span class="ow">in</span> <span class="n">flow</span> <span class="ow">and</span> <span class="s2">&quot;in&quot;</span> <span class="ow">in</span> <span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]:</span>
            <span class="k">del</span> <span class="n">sh</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span>

    <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">dhwBus</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="s2">&quot;Demand&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="n">dhw</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dhwBus</span><span class="p">[</span><span class="n">flow</span><span class="p">])]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dhw</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dhwBus</span><span class="p">[</span><span class="n">flow</span><span class="p">]),</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;Storage_&quot;</span> <span class="ow">in</span> <span class="n">flow</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">dhw</span><span class="p">[</span><span class="n">newLegends</span><span class="p">[</span><span class="n">flow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__Building&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">)]]</span>

    <span class="n">elec</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">elec</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">elec</span> <span class="o">=</span> <span class="n">elec</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">sh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">sh</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">dhw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dhw</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">dhw</span> <span class="o">=</span> <span class="n">dhw</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">elec_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">elec</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp0</span> <span class="o">=</span> <span class="n">elec</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">elec_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">sh_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sh</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp1</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">sh_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">dhw_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">COLORS</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dhw</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp2</span> <span class="o">=</span> <span class="n">dhw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dhw_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># remove scenario names from other bar plots</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Building &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">building</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">groupHbarPlots</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">group_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inner_sep</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># set limits and ticks for both axes</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="c1"># group 1,000,000 with commas</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">group_thousands_and_skip_first</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{:0,d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">group_thousands_and_skip_first</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skip_lowest</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">skip_lowest</span><span class="p">)</span>

        <span class="c1"># legend</span>
        <span class="c1"># set style arguments</span>
        <span class="n">legend_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;lower center&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ncol&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                        <span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">.99</span><span class="p">)}</span>
        <span class="c1"># get handels and labels, remove duplicate labels</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">deduplicateLegend</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">())</span>
        <span class="c1"># set legend to use those</span>
        <span class="n">lg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_style</span><span class="p">)</span>
        <span class="c1"># finally, remove lines from patches</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">lg</span><span class="o">.</span><span class="n">get_patches</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Demand and energy produced</span><span class="se">\n</span><span class="s1"> for electricity (kWh)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Demand and energy produced</span><span class="se">\n</span><span class="s1"> for space heating (kWh)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Demand and energy produced</span><span class="se">\n</span><span class="s1"> for domestic hot water (kWh)&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">elec</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">dhw</span></div>

<div class="viewcode-block" id="resultingDataDemandDiagramLoop"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.resultingDataDemandDiagramLoop">[docs]</a><span class="k">def</span> <span class="nf">resultingDataDemandDiagramLoop</span><span class="p">(</span><span class="n">elec</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">dhw</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">buildings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function inspired from the URBS platform https://github.com/ojdo/urbs/blob/1house/comp.py</span>
<span class="sd">    Function plotting the graph comparing the different buildings/scenarios on costs, energy produced and energy</span>
<span class="sd">    retrieved from storages</span>
<span class="sd">    :param elec: list of dict type, optimization results</span>
<span class="sd">    :param sh: list of dict type, optimization results</span>
<span class="sd">    :param dhw: list of dict type, optimization results</span>
<span class="sd">    :param colors: list type, different colors for the different components of the system</span>
<span class="sd">    :param buildings: list of str type, name of the different buildings</span>
<span class="sd">    :return: figure created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_elec</span><span class="p">,</span> <span class="n">n_sh</span><span class="p">,</span> <span class="n">n_dhw</span> <span class="o">=</span> <span class="n">resultingDataDemandDiagram</span><span class="p">(</span><span class="n">elec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dhw</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">buildings</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elec</span><span class="p">)):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">resultingDataDemandDiagram</span><span class="p">(</span><span class="n">elec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dhw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">colors</span><span class="p">,</span> <span class="n">buildings</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">n_elec</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n_elec</span><span class="p">,</span> <span class="n">a</span><span class="p">])</span>
        <span class="n">n_sh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n_sh</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
        <span class="n">n_dhw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">n_dhw</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">elec_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_elec</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp0</span> <span class="o">=</span> <span class="n">n_elec</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">elec_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">sh_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_sh</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp1</span> <span class="o">=</span> <span class="n">n_sh</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">sh_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">dhw_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">toColor</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n_dhw</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">bp2</span> <span class="o">=</span> <span class="n">n_dhw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dhw_colors</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># remove scenario names from other bar plots</span>
    <span class="n">liste</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
        <span class="n">liste</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">liste</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">liste</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Building &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">liste</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">groupHbarPlots</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">group_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inner_sep</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># set limits and ticks for both axes</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

        <span class="c1"># group 1,000,000 with commas</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">group_thousands_and_skip_first</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{:0,d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">group_thousands_and_skip_first</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">skip_lowest</span> <span class="o">=</span> <span class="n">tkr</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">skip_lowest</span><span class="p">)</span>

        <span class="c1"># legend</span>
        <span class="c1"># set style arguments</span>
        <span class="n">legend_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;frameon&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="s1">&#39;lower center&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;ncol&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                        <span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">.99</span><span class="p">)}</span>
        <span class="c1"># get handels and labels, remove duplicate labels</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">deduplicateLegend</span><span class="p">(</span><span class="o">*</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">())</span>
        <span class="c1"># set legend to use those</span>
        <span class="n">lg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_style</span><span class="p">)</span>
        <span class="c1"># finally, remove lines from patches</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">lg</span><span class="o">.</span><span class="n">get_patches</span><span class="p">(),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax0</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Demand and energy produced</span><span class="se">\n</span><span class="s1"> for electricity (kWh)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Demand and energy produced</span><span class="se">\n</span><span class="s1"> for space heating (kWh)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Demand and energy produced</span><span class="se">\n</span><span class="s1"> for domestic hot water (kWh)&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="getData"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.getData">[docs]</a><span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for the results recovery from an Excel file</span>
<span class="sd">    :param filepath: path to the Excel containing the results of the optimization</span>
<span class="sd">    :return: the different dicts created during the optimization</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_links</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dict_sheet</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">wb</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">:</span>
        <span class="n">dict_sheet</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dict_sheet</span></div>

<div class="viewcode-block" id="loadPlottingData"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.loadPlottingData">[docs]</a><span class="k">def</span> <span class="nf">loadPlottingData</span><span class="p">(</span><span class="n">resultFilePath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for loading the data from excel file into variables</span>
<span class="sd">    :param resultFilePath: path to the Excel containing the results of the optimization</span>
<span class="sd">    :return: the different variables created after reading the excel file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">buses</span> <span class="o">=</span> <span class="n">getData</span><span class="p">(</span><span class="n">resultFilePath</span><span class="p">)</span>
    <span class="n">elec_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">elec_dict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sh_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sh_dict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dhw_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dhw_dict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">costs_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">costs_dict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">env_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">env_dict</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">buildings_dict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buildings_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">buildings_number</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">buses</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">beta</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">alpha_a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">building</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Building&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># building number</span>
        <span class="n">beta_bis</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">beta</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">building</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="s2">&quot;electricityBus&quot;</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">or</span> <span class="s2">&quot;electricityInBus&quot;</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">or</span> <span class="s2">&quot;electricityProdBus&quot;</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">or</span> <span class="s2">&quot;spaceHeatingBus&quot;</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">or</span> <span class="s2">&quot;shDemandBus&quot;</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">or</span> <span class="s2">&quot;shSourceBus&quot;</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">or</span> <span class="s2">&quot;domesticHotWaterBus&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;shDemandBus&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">j</span> <span class="ow">and</span> <span class="s2">&quot;shSourceBus&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">alpha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;electricityBus&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;electricityInBus&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;electricityProdBus&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">):</span>
                    <span class="c1"># find the index of electricity bus to merge the results of electricityBus, electricityInBus and electricityProdBus</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alpha_a</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="s2">&quot;electricityBus&quot;</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;electricityInBus&quot;</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;electricityProdBus&quot;</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">ind</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">buses</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">alpha_a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;spaceHeatingBus&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;shDemandBus&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;shSourceBus&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="p">):</span>
                    <span class="c1"># find the index of spaceHeatingBus to merge the results of spaceHeatingBus, shDemandBus and shSourceBus</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alpha_a</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="s2">&quot;spaceHeatingBus&quot;</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;shDemandBus&quot;</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s2">&quot;shSourceBus&quot;</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">ind</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">buses</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;((&#39;spaceHeating__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;, &#39;shDemandBus__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;), &#39;flow&#39;)&quot;</span>
                        <span class="k">if</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;((&#39;shSourceBus__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;, &#39;shSource__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;), &#39;flow&#39;)&quot;</span>
                        <span class="k">if</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_a</span><span class="p">)</span>
                        <span class="n">alpha_a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;((&#39;spaceHeating__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;, &#39;shDemandBus__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;), &#39;flow&#39;)&quot;</span>
                        <span class="k">if</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                        <span class="n">flow</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;((&#39;shSourceBus__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;, &#39;shSource__Building</span><span class="si">{</span><span class="n">building</span><span class="si">}</span><span class="s2">&#39;), &#39;flow&#39;)&quot;</span>
                        <span class="k">if</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">alpha_a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">alpha_a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">beta_bis</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">buildings_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha_a</span><span class="p">)</span>
            <span class="n">buildings_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">buildings_number</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">building</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="n">beta</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">buses</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Building&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># building number</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;electricityBus&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;electricityInBus&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;electricityProdBus&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">elec_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">elec_dict</span><span class="p">):</span>  <span class="c1"># to merge the data of the two electricity buses of the same  (elec_dict[0] should have all the electricity related data of building 1, and so on...)</span>
                <span class="n">elec_dict</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">elec_dict</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elec_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;spaceHeating&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;shDemand&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;shSource&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;shDemand&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">and</span> <span class="s2">&quot;spaceHeating&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">sh_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">sh_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sh_names</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">sh_dict</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">sh_dict</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">flow</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;((&#39;spaceHeating__Building</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&#39;, &#39;shDemandBus__Building</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&#39;), &#39;flow&#39;)&quot;</span>
                <span class="k">if</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">sh_dict</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">sh_dict</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;((&#39;shSourceBus__Building</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&#39;, &#39;shSource__Building</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&#39;), &#39;flow&#39;)&quot;</span>
                <span class="k">if</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">sh_dict</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">sh_dict</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;domesticHotWater&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">dhw_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">dhw_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;costs&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">costs_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">costs_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;env_impacts&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">env_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">env_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">buses</span><span class="p">,</span> <span class="n">elec_names</span><span class="p">,</span> <span class="n">elec_dict</span><span class="p">,</span> <span class="n">sh_names</span><span class="p">,</span> <span class="n">sh_dict</span><span class="p">,</span> <span class="n">dhw_names</span><span class="p">,</span> <span class="n">dhw_dict</span><span class="p">,</span> <span class="n">costs_names</span><span class="p">,</span> <span class="n">costs_dict</span><span class="p">,</span> <span class="n">env_names</span><span class="p">,</span> <span class="n">env_dict</span><span class="p">,</span>\
           <span class="n">buildings_dict</span><span class="p">,</span> <span class="n">buildings_names</span><span class="p">,</span> <span class="n">buildings_number</span></div>

<div class="viewcode-block" id="createPlot"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.createPlot">[docs]</a><span class="k">def</span> <span class="nf">createPlot</span><span class="p">(</span><span class="n">resultFilePath</span><span class="p">,</span> <span class="n">basePath</span><span class="p">,</span> <span class="n">plotLevel</span><span class="p">,</span> <span class="n">plotType</span><span class="p">,</span> <span class="n">flowType</span><span class="p">,</span> <span class="n">plotAnnualHorizontalBar</span><span class="p">,</span> <span class="n">newLegends</span><span class="p">):</span>
    <span class="c1"># load the plotting data from excel file into variables</span>
    <span class="n">buses</span><span class="p">,</span> <span class="n">elec_names</span><span class="p">,</span> <span class="n">elec_dict</span><span class="p">,</span> <span class="n">sh_names</span><span class="p">,</span> <span class="n">sh_dict</span><span class="p">,</span> <span class="n">dhw_names</span><span class="p">,</span> <span class="n">dhw_dict</span><span class="p">,</span> <span class="n">costs_names</span><span class="p">,</span> <span class="n">costs_dict</span><span class="p">,</span> <span class="n">env_names</span><span class="p">,</span> <span class="n">env_dict</span><span class="p">,</span> \
    <span class="n">buildings_dict</span><span class="p">,</span> <span class="n">buildings_names</span><span class="p">,</span> <span class="n">buildings_number</span> <span class="o">=</span> <span class="n">loadPlottingData</span><span class="p">(</span><span class="n">resultFilePath</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">flowType</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s2">&quot;energy balance&quot;</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">elec_names</span> <span class="o">+</span> <span class="n">sh_names</span> <span class="o">+</span> <span class="n">dhw_names</span>
        <span class="k">elif</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s2">&quot;bokeh&quot;</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">buildings_names</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">buildings_dict</span>
    <span class="k">elif</span> <span class="n">flowType</span> <span class="o">==</span> <span class="s2">&quot;electricity&quot;</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">elec_names</span>
        <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s2">&quot;bokeh&quot;</span><span class="p">:</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">elec_dict</span>
    <span class="k">elif</span> <span class="n">flowType</span> <span class="o">==</span> <span class="s2">&quot;space heat&quot;</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">sh_names</span>
        <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s2">&quot;bokeh&quot;</span><span class="p">:</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">sh_dict</span>
    <span class="k">elif</span> <span class="n">flowType</span> <span class="o">==</span> <span class="s2">&quot;domestic hot water&quot;</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">dhw_names</span>
        <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s2">&quot;bokeh&quot;</span><span class="p">:</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="n">dhw_dict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Illegal value for the parameter flow type&quot;</span><span class="p">)</span>

    <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Jan&quot;</span><span class="p">,</span> <span class="s2">&quot;Feb&quot;</span><span class="p">,</span> <span class="s2">&quot;Mar&quot;</span><span class="p">,</span> <span class="s2">&quot;Apr&quot;</span><span class="p">,</span> <span class="s2">&quot;May&quot;</span><span class="p">,</span> <span class="s2">&quot;Jun&quot;</span><span class="p">,</span> <span class="s2">&quot;Jul&quot;</span><span class="p">,</span> <span class="s2">&quot;Aug&quot;</span><span class="p">,</span> <span class="s2">&quot;Sep&quot;</span><span class="p">,</span> <span class="s2">&quot;Oct&quot;</span><span class="p">,</span> <span class="s2">&quot;Nov&quot;</span><span class="p">,</span> <span class="s2">&quot;Dec&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s2">&quot;energy balance&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotLevel</span> <span class="o">==</span> <span class="s2">&quot;allMonths&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;electricityBus&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">monthlyBalance</span><span class="p">(</span><span class="n">buses</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">newLegends</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">plotType</span> <span class="o">==</span> <span class="s2">&quot;bokeh&quot;</span><span class="p">:</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">plotLevel</span> <span class="ow">in</span> <span class="n">months</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flowType</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buildings_names</span><span class="p">)):</span>
                    <span class="n">tempDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tempDict</span><span class="p">)):</span>
                        <span class="n">tempDict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempDict</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">tempDict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">plotLevel</span><span class="p">]</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempDict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
                    <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">plotLevel</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="nb">chr</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="nb">chr</span> <span class="ow">in</span> <span class="n">plotLevel</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">isoparse</span><span class="p">(</span><span class="n">plotLevel</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">flowType</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buildings_names</span><span class="p">)):</span>
                        <span class="n">tempDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tempDict</span><span class="p">)):</span>
                            <span class="n">tempDict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempDict</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">tempDict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">plotLevel</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()]</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempDict</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">dict</span><span class="p">)):</span>
                        <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">date</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">plotLevel</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">flowType</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">plotsHourly</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">plotsDaily</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buildings_names</span><span class="p">)):</span>
                <span class="n">plotsH</span><span class="p">,</span> <span class="n">plotsD</span> <span class="o">=</span> <span class="n">hourlyDailyPlot</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Category20_12</span><span class="p">,</span> <span class="n">newLegends</span><span class="p">)</span>
                <span class="n">plotsHourly</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">plotsH</span><span class="p">)</span>
                <span class="n">plotsDaily</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">plotsD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotsHourly</span><span class="p">,</span> <span class="n">plotsDaily</span> <span class="o">=</span> <span class="n">hourlyDailyPlot</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">Category20_12</span><span class="p">,</span> <span class="n">newLegends</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">basePath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">basePath</span><span class="p">)</span>

        <span class="n">output_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basePath</span><span class="p">,</span><span class="s2">&quot;HourlyBokehPlots.html&quot;</span><span class="p">))</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">plotsHourly</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">chr</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="nb">chr</span> <span class="ow">in</span> <span class="n">plotLevel</span><span class="p">):</span>
            <span class="n">output_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basePath</span><span class="p">,</span><span class="s2">&quot;DailyBokehPlots.html&quot;</span><span class="p">))</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">plotsDaily</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">)</span>
            <span class="n">show</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Illegal value for the parameter plot type&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotAnnualHorizontalBar</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">my_colors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Battery_out&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
            <span class="s1">&#39;Battery_in&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
            <span class="s1">&#39;Storage_sh_out&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">196</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span>
            <span class="s1">&#39;Storage_dhw_out&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">196</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">27</span><span class="p">),</span>
            <span class="s1">&#39;HP_dhw&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;HP_sh&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;HP&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;CHP_elec&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">189</span><span class="p">),</span>
            <span class="s1">&#39;CHP_sh&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">189</span><span class="p">),</span>
            <span class="s1">&#39;CHP_dhw&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="s1">&#39;CHP&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">189</span><span class="p">),</span>
            <span class="s1">&#39;Gas_sh&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
            <span class="s1">&#39;GasBoiler&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>
            <span class="s1">&#39;PV_elec&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
            <span class="s1">&#39;SolarCollector&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">188</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
            <span class="s1">&#39;Inputs&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">252</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">93</span><span class="p">),</span>
            <span class="s1">&#39;Operation&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">252</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">93</span><span class="p">),</span>
            <span class="s1">&#39;Investment&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">138</span><span class="p">),</span>
            <span class="s1">&#39;Feed-in&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">203</span><span class="p">),</span>
            <span class="s1">&#39;Demand_elec&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">131</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">151</span><span class="p">),</span>
            <span class="s1">&#39;Demand_sh&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">131</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">151</span><span class="p">),</span>
            <span class="s1">&#39;Demand_dhw&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">131</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">151</span><span class="p">),</span>
            <span class="s1">&#39;Grid_purchase&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">237</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">optMode</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="n">my_colors</span><span class="p">[</span><span class="s1">&#39;electricityLink_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">my_colors</span><span class="p">[</span><span class="s1">&#39;electricityLink_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">my_colors</span><span class="p">[</span><span class="s1">&#39;electricityLink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
        <span class="n">COLORS</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">my_colors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">COLORS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        for i in range(len(buildings_names)):</span>
<span class="sd">            fig1 = resultingDataDiagram(elec_dict[i], sh_dict[i], dhw_dict[i], costs_dict[i], env_dict[i], COLORS, buildings_number[i])[0]</span>
<span class="sd">            fig2 = resultingDataDemandDiagram(elec_dict[i], sh_dict[i], dhw_dict[i], COLORS, buildings_number[i])[0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig3</span> <span class="o">=</span> <span class="n">resultingDataDiagramLoop</span><span class="p">(</span><span class="n">elec_dict</span><span class="p">,</span> <span class="n">sh_dict</span><span class="p">,</span> <span class="n">dhw_dict</span><span class="p">,</span> <span class="n">costs_dict</span><span class="p">,</span> <span class="n">env_dict</span><span class="p">,</span> <span class="n">COLORS</span><span class="p">,</span> <span class="n">buildings_number</span><span class="p">)</span>
        <span class="n">fig4</span> <span class="o">=</span> <span class="n">resultingDataDemandDiagramLoop</span><span class="p">(</span><span class="n">elec_dict</span><span class="p">,</span> <span class="n">sh_dict</span><span class="p">,</span> <span class="n">dhw_dict</span><span class="p">,</span> <span class="n">COLORS</span><span class="p">,</span> <span class="n">buildings_number</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot"><a class="viewcode-back" href="../../optihood.html#optihood.plot_functions.plot">[docs]</a><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">excelFileName</span><span class="p">,</span> <span class="n">figureFilePath</span><span class="p">,</span> <span class="n">plotLevel</span><span class="p">,</span> <span class="n">plotType</span><span class="p">,</span> <span class="n">flowType</span><span class="p">,</span> <span class="n">plotAnnualHorizontalBar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1">#####################################</span>
    <span class="c1">########## Classic plots  ###########</span>
    <span class="c1">#####################################</span>
    <span class="c1"># New legends need to be defined by hand for each new flow added to the energy network</span>
    <span class="n">newLegends</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;((&#39;naturalGasResource&#39;, &#39;naturalGasBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;NaturalGas&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityBus&#39;, &#39;excesselectricityBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Feed-in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityProdBus&#39;, &#39;electricalStorage&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Battery_in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityInBus&#39;, &#39;electricityDemand&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Demand_elec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityInBus&#39;, &#39;HP&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;HP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;CHP&#39;, &#39;electricityProdBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;CHP_elec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricalStorage&#39;, &#39;electricityBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Battery_out&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricitySource&#39;, &#39;electricityBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Elect_produced (not stored)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityResource&#39;, &#39;gridBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Grid_purchase&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;dhwStorage&#39;, &#39;domesticHotWaterBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Storage_dhw_out&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;dhwStorageBus&#39;, &#39;dhwStorage&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Storage_dhw_in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;domesticHotWaterBus&#39;, &#39;domesticHotWaterDemand&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Demand_dhw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;HP&#39;, &#39;dhwStorageBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;HP_dhw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;CHP&#39;, &#39;dhwStorageBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;CHP_dhw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;shSource&#39;, &#39;spaceHeatingBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;SH_produced (not stored)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;shStorage&#39;, &#39;spaceHeatingBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Storage_sh_out&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage_content&quot;</span><span class="p">:</span> <span class="s2">&quot;Storage_content&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;shSourceBus&#39;, &#39;shStorage&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Storage_sh_in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;spaceHeatingBus&#39;, &#39;spaceHeating&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;SH_direct_to_load&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;shDemandBus&#39;, &#39;spaceHeatingDemand&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Demand_sh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;CHP&#39;, &#39;shSourceBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;CHP_sh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;GasBoiler&#39;, &#39;shSourceBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Gas_sh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;HP&#39;, &#39;shSourceBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;HP_sh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityBus&#39;, &#39;producedElectricity&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Self_consumption&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;gridBus&#39;, &#39;gridElectricity&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Electricity_grid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;pv&#39;, &#39;electricityProdBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;PV_elec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;solarCollector&#39;, &#39;dhwStorageBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;SolarCollector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityInBus&#39;, &#39;solarCollector&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;SolarCollector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;gridElectricity&#39;, &#39;electricityInBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Electricity_grid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;producedElectricity&#39;, &#39;electricityInBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Self_consumption&quot;</span><span class="p">,</span>
        <span class="s2">&quot;((&#39;electricityProdBus&#39;, &#39;electricitySource&#39;), &#39;flow&#39;)&quot;</span><span class="p">:</span> <span class="s2">&quot;Battery_bypass&quot;</span>
    <span class="p">}</span>
    <span class="n">newLegends</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityBus&#39;, &#39;electricityLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;electricityLink_in&quot;</span>
    <span class="n">newLegends</span><span class="p">[</span><span class="s2">&quot;((&#39;electricityLink&#39;, &#39;electricityInBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;electricityLink_out&quot;</span>
    <span class="n">newLegends</span><span class="p">[</span><span class="s2">&quot;((&#39;spaceHeatingBus&#39;, &#39;shLink&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;shLink_in&quot;</span>
    <span class="n">newLegends</span><span class="p">[</span><span class="s2">&quot;((&#39;shLink&#39;, &#39;shDemandBus&#39;), &#39;flow&#39;)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;shLink_out&quot;</span>

    <span class="n">createPlot</span><span class="p">(</span><span class="n">excelFileName</span><span class="p">,</span> <span class="n">figureFilePath</span><span class="p">,</span> <span class="n">plotLevel</span><span class="p">,</span> <span class="n">plotType</span><span class="p">,</span> <span class="n">flowType</span><span class="p">,</span> <span class="n">plotAnnualHorizontalBar</span><span class="p">,</span> <span class="n">newLegends</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">optMode</span> <span class="o">=</span> <span class="s2">&quot;group&quot;</span>  <span class="c1"># parameter defining whether the results file corresponds to &quot;indiv&quot; or &quot;group&quot; optimization</span>
    <span class="n">numberOfBuildings</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">plotOptim</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># defines the number of the optimization to plot</span>
    <span class="n">plotLevel</span> <span class="o">=</span> <span class="s2">&quot;allMonths&quot;</span>  <span class="c1"># permissible values (for energy balance plot): &quot;allMonths&quot; {for all months}</span>
    <span class="c1"># or specific month {&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, etc. three letter abbreviation of the month name}</span>
    <span class="c1"># or specific date {format: YYYY-MM-DD}</span>
    <span class="n">plotType</span> <span class="o">=</span> <span class="s2">&quot;energy balance&quot;</span>  <span class="c1"># permissible values: &quot;energy balance&quot;, &quot;bokeh&quot;</span>
    <span class="n">flowType</span> <span class="o">=</span> <span class="s2">&quot;electricity&quot;</span>  <span class="c1"># permissible values: &quot;all&quot;, &quot;electricity&quot;, &quot;space heat&quot;, &quot;domestic hot water&quot;</span>
    <span class="n">plotAnnualHorizontalBar</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># determines whether the annual horizontal bar is plot or not</span>

    <span class="n">plot</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;..\data\Results&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;results</span><span class="si">{</span><span class="n">numberOfBuildings</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">plotOptim</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">optMode</span><span class="si">}</span><span class="s2">.xlsx&quot;</span><span class="p">),</span> <span class="sa">r</span><span class="s2">&quot;..\data\Figures&quot;</span><span class="p">,</span> <span class="n">plotLevel</span><span class="p">,</span> <span class="n">plotType</span><span class="p">,</span> <span class="n">flowType</span><span class="p">,</span> <span class="n">plotAnnualHorizontalBar</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Dani Carbonell, Mattia Battaglia, Jeremias Schmidli, Maike Schubert, Martin Neugebauer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>